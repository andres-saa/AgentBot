version: '3.9'
services:
  redis:
    image: redis:7-alpine
    container_name: mi_ia_personal_redis_dev
    env_file: ./db/.env
    command: ['redis-server','--appendonly','yes','--requirepass','${REDIS_PASSWORD}']
    volumes:
      - redis_data:/data
    ports:
      - '6379:6379'
    restart: unless-stopped

  api_chat:
    build: { context: ./backend/chat, target: dev }
    container_name: mi_ia_personal_api_chat_dev
    env_file: ./backend/chat/.env
    volumes:
      - ./backend/chat/app:/code
    environment:
      CHOKIDAR_USEPOLLING: "true"
    depends_on: [redis]
    ports:
      - '8000:80'
    restart: unless-stopped

  api_socket:
    build: { context: ./backend/socket, target: dev }
    container_name: mi_ia_personal_api_socket_dev
    env_file: ./backend/socket/.env
    volumes:
      - ./backend/socket/app:/code
    environment:
      CHOKIDAR_USEPOLLING: "true"
    depends_on: [redis]
    ports:
      - '8001:80'
    restart: unless-stopped

volumes:
  redis_data:
